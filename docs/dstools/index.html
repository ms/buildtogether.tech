<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<script defer data-domain="buildtogether.tech" src="https://plausible.io/js/plausible.js"></script>
<link rel="icon" type="image/x-icon" href="../files/favicon.ico">
<link rel="stylesheet" href="../mccole.css">
<link rel="stylesheet" href="../codehilite-tango.css">

    <title>Building Software Together: Data Science Tools</title>
  </head>
  <body class="page">
    <div class="centered title">
      
      <h2><a href="../">Building Software Together</a></h2>
      <h1>Chapter 5: Data Science Tools</h1>
      
      <p>
        <img class="page-logo" src="../codebender.svg" alt="logo" />
      </p>
    </div>

<ul>
<li>Motivating problem: how big is the average Python package?</li>
<li>What do we mean by "big"?<ul>
<li>Count lines and characters for now</li>
</ul>
</li>
<li>What do we mean by "average"?<ul>
<li>Analyze the packages on this computer to start</li>
</ul>
</li>
</ul>
<h2>Getting Data</h2>
<ul>
<li>Where is Python installed?</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python37</span><span class="o">.</span><span class="n">zip</span><span class="w"></span>
<span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="w"></span>
<span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">lib</span><span class="o">-</span><span class="n">dynload</span><span class="w"></span>
<span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="w"></span>
</code></pre></div>

<ul>
<li>The blank at the start is the empty string, which means "current directory"</li>
<li>Use the shell to find and display Python file sizes</li>
</ul>
<div class="codehilite"><pre><span></span><code>find /anaconda3 -name <span class="s1">&#39;*.py&#39;</span> -exec wc -l -c <span class="o">{}</span> <span class="se">\;</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>      27     877 /anaconda3/bin/rst2xetex.py
      26     797 /anaconda3/bin/rst2latex.py
      67    1704 /anaconda3/bin/rst2odt_prepstyles.py
      26     720 /anaconda3/bin/rst2html4.py
      35    1145 /anaconda3/bin/rst2html5.py
...
</code></pre></div>

<ul>
<li>We could convert this output to <span g="csv">comma-separated values</span> (CSV)
    with command-line tools like [awk][awk] or [sed][sed]<ul>
<li>But since we're using Python anyway...</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lines,Characters,Path&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">:</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">fields</span><span class="p">))</span>
</code></pre></div>

<ul>
<li>Run it as shown below<ul>
<li>Break lines to make commands more visible (and to prevent long lines)</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>find /anaconda3 -name <span class="s1">&#39;*.py&#39;</span> -exec wc -l -c <span class="o">{}</span> <span class="se">\;</span> <span class="se">\</span>
  <span class="p">|</span> python wc2csv.py <span class="se">\</span>
  &gt; python-local-package-size.csv
cat python-local-package-size.csv
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Lines,Characters,Path
27,877,/anaconda3/bin/rst2xetex.py
26,797,/anaconda3/bin/rst2latex.py
67,1704,/anaconda3/bin/rst2odt_prepstyles.py
26,720,/anaconda3/bin/rst2html4.py
35,1145,/anaconda3/bin/rst2html5.py
...
</code></pre></div>

<ul>
<li>This is <span g="tidy_data">tidy data</span><ol>
<li>Each column contains one statistical variable
    (i.e., one property that was measured or observed)</li>
<li>Each different observation is in a different row</li>
<li>There is one table for each set of observations</li>
<li>If there are multiple tables,
    each table has a column containing a unique <span g="key">key</span>
    so that related data can be linked</li>
</ol>
</li>
</ul>
<h2>Analyzing Tabular Data</h2>
<ul>
<li>There's a lot of tabular data in the world</li>
<li>People want to do a lot of complex things with it, so Python's tools can be bewildering at first<ol>
<li>Built-in lists and the <code>array</code> module</li>
<li>[NumPy][numpy] provides multidimensional arrays</li>
<li>[Pandas][pandas] provides <span g="dataframe">dataframes</span> with named columns for tidy data</li>
</ol>
</li>
<li>We will use a small subset of Pandas<ul>
<li>Gives us tables whose columns can have different datatypes</li>
<li>Access columns by name</li>
<li>Access rows by index</li>
</ul>
</li>
<li>Load our CSV data into memory and have a look</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;python-local-package-size.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>       Lines  Characters                                               Path
0         27         877                        /anaconda3/bin/rst2xetex.py
1         26         797                        /anaconda3/bin/rst2latex.py
2         67        1704               /anaconda3/bin/rst2odt_prepstyles.py
...
33243    256       10135  /anaconda3/share/glib-2.0/codegen/codegen_main.py
33244    431       17774     /anaconda3/share/glib-2.0/codegen/dbustypes.py
33245   3469      206544       /anaconda3/share/glib-2.0/codegen/codegen.py

[33246 rows x 3 columns]
</code></pre></div>

<ul>
<li>The <span g="header_row">header row</span> tells us the names of the columns</li>
<li>We can get these names using the dataframe's <code>columns</code> <span g="property">property</span><ul>
<li>Not a method call</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(data.columns)
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Index([&#39;Lines&#39;, &#39;Characters&#39;, &#39;Path&#39;], dtype=&#39;object&#39;)
</code></pre></div>

<ul>
<li>Result is an <code>Index</code> object containing the columns' names and other information</li>
<li>Its <code>values</code> property contains just the names</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(data.columns.values)
</code></pre></div>

<div class="codehilite"><pre><span></span><code>[&#39;Lines&#39; &#39;Characters&#39; &#39;Path&#39;]
</code></pre></div>

<ul>
<li>We normally import Pandas using an <span g="alias">alias</span> called <code>pd</code>
    to save a few characters of typing and (more importantly) make code a little easier to read</li>
<li>Re-load our data that way<ul>
<li>And use a more meaningful name than <code>data</code></li>
<li>Then select a column by name</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">packages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;python-local-package-size.csv&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">packages</span><span class="p">[</span><span class="s1">&#39;Path&#39;</span><span class="p">])</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">                              </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rst2xetex</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="mf">1</span><span class="w">                              </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rst2latex</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="mf">2</span><span class="w">                     </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">rst2odt_prepstyles</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="mf">...</span><span class="w"></span>
<span class="mf">33243</span><span class="w">    </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">glib</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">codegen_main</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="mf">33244</span><span class="w">       </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">glib</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">dbustypes</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="mf">33245</span><span class="w">         </span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">glib</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">codegen</span><span class="o">/</span><span class="n">codegen</span><span class="mf">.</span><span class="n">py</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">Path</span><span class="p">,</span><span class="w"> </span><span class="nb">Len</span><span class="n">gth</span><span class="p">:</span><span class="w"> </span><span class="mf">33246</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="n">object</span><span class="w"></span>
</code></pre></div>

<ul>
<li>The line at the end tells us:<ul>
<li>The name of the column we selected</li>
<li>How many records there are</li>
<li>The column's data type</li>
</ul>
</li>
<li>We can select several columns at once by giving a list of names<ul>
<li>Which results in double square brackets</li>
<li>Outer brackets mean "we're selecting something"</li>
<li>Inner ones means "we're providing a list to specify what we're selecting"</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages[[&#39;Lines&#39;, &#39;Characters&#39;]])
</code></pre></div>

<div class="codehilite"><pre><span></span><code>       Lines  Characters
0         27         877
1         26         797
2         67        1704
...
33243    256       10135
33244    431       17774
33245   3469      206544

[33246 rows x 2 columns]
</code></pre></div>

<ul>
<li>What if we want to select a row?</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages[0])
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="nv">Traceback</span> <span class="ss">(</span><span class="nv">most</span> <span class="nv">recent</span> <span class="k">call</span> <span class="nl">last</span><span class="ss">)</span>:
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">/anaconda3/lib/python3.7/site-packages/pandas/core/indexes/base.py</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">2657</span>, <span class="nv">in</span> <span class="nv">get_loc</span>
    <span class="k">return</span> <span class="nv">self</span>.<span class="nv">_engine</span>.<span class="nv">get_loc</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/index.pyx</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">108</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">index</span>.<span class="nv">IndexEngine</span>.<span class="nv">get_loc</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/index.pyx</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">132</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">index</span>.<span class="nv">IndexEngine</span>.<span class="nv">get_loc</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/hashtable_class_helper.pxi</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">1601</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">hashtable</span>.<span class="nv">PyObjectHashTable</span>.<span class="nv">get_item</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/hashtable_class_helper.pxi</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">1608</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">hashtable</span>.<span class="nv">PyObjectHashTable</span>.<span class="nv">get_item</span>
<span class="nv">KeyError</span>: <span class="mi">0</span>

<span class="nv">During</span> <span class="nv">handling</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">above</span> <span class="nv">exception</span>, <span class="nv">another</span> <span class="nv">exception</span> <span class="nv">occurred</span>:

<span class="nv">Traceback</span> <span class="ss">(</span><span class="nv">most</span> <span class="nv">recent</span> <span class="k">call</span> <span class="nl">last</span><span class="ss">)</span>:
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas-select-row-fail.py</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">4</span>, <span class="nv">in</span> <span class="o">&lt;</span><span class="nv">module</span><span class="o">&gt;</span>
    <span class="nv">print</span><span class="ss">(</span><span class="nv">packages</span>[<span class="mi">0</span>]<span class="ss">)</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">/anaconda3/lib/python3.7/site-packages/pandas/core/frame.py</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">2927</span>, <span class="nv">in</span> <span class="nv">__getitem__</span>
    <span class="nv">indexer</span> <span class="o">=</span> <span class="nv">self</span>.<span class="nv">columns</span>.<span class="nv">get_loc</span><span class="ss">(</span><span class="nv">key</span><span class="ss">)</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">/anaconda3/lib/python3.7/site-packages/pandas/core/indexes/base.py</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">2659</span>, <span class="nv">in</span> <span class="nv">get_loc</span>
    <span class="k">return</span> <span class="nv">self</span>.<span class="nv">_engine</span>.<span class="nv">get_loc</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">_maybe_cast_indexer</span><span class="ss">(</span><span class="nv">key</span><span class="ss">))</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/index.pyx</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">108</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">index</span>.<span class="nv">IndexEngine</span>.<span class="nv">get_loc</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/index.pyx</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">132</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">index</span>.<span class="nv">IndexEngine</span>.<span class="nv">get_loc</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/hashtable_class_helper.pxi</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">1601</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">hashtable</span>.<span class="nv">PyObjectHashTable</span>.<span class="nv">get_item</span>
  <span class="nv">File</span> <span class="s2">&quot;</span><span class="s">pandas/_libs/hashtable_class_helper.pxi</span><span class="s2">&quot;</span>, <span class="nv">line</span> <span class="mi">1608</span>, <span class="nv">in</span> <span class="nv">pandas</span>.<span class="nv">_libs</span>.<span class="nv">hashtable</span>.<span class="nv">PyObjectHashTable</span>.<span class="nv">get_item</span>
<span class="nv">KeyError</span>: <span class="mi">0</span>
</code></pre></div>

<ul>
<li>Pandas error messages aren't particularly readable</li>
<li>Pandas doesn't allow us to select rows by numeric index<ul>
<li>Ambiguous, since <code>1</code> could mean "first column" rather than "first row"</li>
</ul>
</li>
<li>Instead, use a property of the dataframe called <code>iloc</code> (for "indexed location")</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages.iloc[0])
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Lines                                  27
Characters                            877
Path          /anaconda3/bin/rst2xetex.py
Name: 0, dtype: object
</code></pre></div>

<ul>
<li>
<p>Displays a two-column table with keys and values</p>
<ul>
<li>Count from zero (for [surprising reasons][hoye-count-from-zero])</li>
</ul>
</li>
<li>
<p>We can use a <span g="slice">slice</span> to select multiple rows</p>
<ul>
<li><span class="rule">If you're writing a loop to process a table, you're doing something wrong</span></li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages.iloc[0:5])
</code></pre></div>

<div class="codehilite"><pre><span></span><code>   Lines  Characters                                  Path
0     27         877           /anaconda3/bin/rst2xetex.py
1     26         797           /anaconda3/bin/rst2latex.py
2     67        1704  /anaconda3/bin/rst2odt_prepstyles.py
3     26         720           /anaconda3/bin/rst2html4.py
4     35        1145           /anaconda3/bin/rst2html5.py
</code></pre></div>

<ul>
<li>We can mix names and numbers to select subsections by column and then row<ul>
<li>Don't need <code>iloc</code> in this case because
    selecting by column gives us back a one-dimensional <code>Series</code> object
    that interprets an integer index the way we want</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages[&#39;Characters&#39;][0:3])
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">     </span><span class="mf">877</span><span class="w"></span>
<span class="mf">1</span><span class="w">     </span><span class="mf">797</span><span class="w"></span>
<span class="mf">2</span><span class="w">    </span><span class="mf">1704</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">Characters</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="mf">64</span><span class="w"></span>
</code></pre></div>

<ul>
<li>Can also select by row and then column using <code>iloc</code><ul>
<li>But indexing out of order makes code harder to read, so don't do this</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(packages.iloc[0:3][&#39;Characters&#39;])
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">     </span><span class="mf">877</span><span class="w"></span>
<span class="mf">1</span><span class="w">     </span><span class="mf">797</span><span class="w"></span>
<span class="mf">2</span><span class="w">    </span><span class="mf">1704</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">Characters</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="mf">64</span><span class="w"></span>
</code></pre></div>

<h2>Visualizing a Dataframe</h2>
<ul>
<li>[<code>matplotlib</code>][matplotlib] is the most widely used plotting module for Python,
    but is fairly low-level</li>
<li>[Plotly Express][plotly] is newer and better suited to creating graphics for browsers<ul>
<li>Usually import using the alias <code>px</code></li>
</ul>
</li>
<li>Use this to create a simple scatter plot<ul>
<li>The figure object's <code>show</code> method runs a local server and opens the image in the browser for viewing</li>
<li>Its <code>write_image</code> method saves it as a file</li>
<li>We put the generated figure in a <code>figures</code> sub-directory to avoid clutter</li>
<li>And use <span g="svg">SVG</span> because <span g="vector_graphics">vector graphics</span> resizes better than <span g="raster_graphics">raster graphics</span></li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">packages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;python-local-package-size.csv&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Lines&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Characters&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s1">&#39;scatter-lines-characters.svg&#39;</span><span class="p">)</span>
</code></pre></div>

<figure id="scatter-lines-characters">
  <img src="./scatter-lines-characters.svg" alt="Scatter plot with most values clustered in the range X equals 0 to 5,000 and Y equals 0 to 0.2 million, with some outliers." />
  <figcaption markdown="1">Figure 5.1: Characters vs. Lines</figcaption>
</figure>

<h2>Calculations with Dataframes</h2>
<ul>
<li>Best way to explore Pandas is by example</li>
<li>Since we don't know what answers to expect from calculations using the package data,
    construct a small example that we can check while we explore</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">example</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">[[</span>  <span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span>   <span class="mi">3</span><span class="p">],</span>
                             <span class="p">[</span> <span class="mi">10</span><span class="p">,</span>  <span class="mi">20</span><span class="p">,</span>  <span class="mi">30</span><span class="p">],</span>
                             <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]],</span>
                       <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">example</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>   left  middle  right
0     1       2      3
1    10      20     30
2   100     200    300
</code></pre></div>

<ul>
<li>Break this down:<ul>
<li><code>pd</code> is the alias for Pandas</li>
<li><code>DataFrame</code> is the kind of object we want to create</li>
<li><code>data</code> is a list-of-lists with the values we want in our dataframe</li>
<li><code>columns</code> is the names we want to give the columns</li>
<li>We could provide <code>data</code> and <code>columns</code> in the opposite order
    and everything would still work
    because we're naming them explicitly</li>
<li>Result is three columns and three rows</li>
</ul>
</li>
<li>We can do arithmetic on entire columns</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(example[&#39;middle&#39;] + example[&#39;right&#39;])
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">      </span><span class="mf">5</span><span class="w"></span>
<span class="mf">1</span><span class="w">     </span><span class="mf">50</span><span class="w"></span>
<span class="mf">2</span><span class="w">    </span><span class="mf">500</span><span class="w"></span>
<span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="mf">64</span><span class="w"></span>
</code></pre></div>

<ul>
<li>If we use a plain old number it is automatically <span g="broadcast">broadcast</span> to the size of the column</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(7 * example[&#39;left&#39;])
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">      </span><span class="mf">7</span><span class="w"></span>
<span class="mf">1</span><span class="w">     </span><span class="mf">70</span><span class="w"></span>
<span class="mf">2</span><span class="w">    </span><span class="mf">700</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="nb">int</span><span class="mf">64</span><span class="w"></span>
</code></pre></div>

<ul>
<li>Sums, averages, and other functions that turn many values into one are called <span g="aggregation">aggregations</span><ul>
<li><code>count</code>: number of elements (excluding <span g="nan"><code>NaN</code></span>)</li>
<li><code>describe</code>: descriptive statistics</li>
<li><code>first</code>: first value</li>
<li><code>last</code>: last value</li>
<li><code>max</code>: largest value</li>
<li><code>mean</code>: average value</li>
<li><code>min</code>: least value</li>
<li><code>nth</code> : \( n^{th} \) value</li>
<li><code>sem</code>: standard error of the mean</li>
<li><code>size</code>: group size (including <code>NaN</code>)</li>
<li><code>std</code>: standard deviation</li>
<li><code>sum</code>: sum of values</li>
<li><code>var</code>: variance</li>
</ul>
</li>
</ul>
<div class="callout">
<h3>Not a Number, Not Available, Null, and None</h3>
<p><code>NaN</code> stands for "Not a Number", a special value used to represent things like
0/0 <cite>Kahan1997</cite>.  Despite the similarity in their names, it is <em>not</em>
the same thing as <span g="na"><code>NA</code></span> (Not Available), which is a
placeholder for missing values.  To make things more confusing, <span
g="sql">SQL</span> (the standard language for querying <span
g="relational_database">relational databases</span>) uses <span
g="null"><code>null</code></span> instead of <code>NA</code> to signal missing data, while many
programming languages use <code>null</code> to mean "a reference that doesn't refer to
anything".  Python uses <code>None</code> instead of <code>null</code>, but we must be careful when
reading and writing data to distinguish between empty strings, missing values,
and the country code for Namibia.</p>
</div>
<ul>
<li>Use the method <code>agg</code> to calculate aggregates<ul>
<li>Give it the name of a function as a string</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(example.agg(&#39;sum&#39;))
</code></pre></div>

<div class="codehilite"><pre><span></span><code>left      111
middle    222
right     333
dtype: int64
</code></pre></div>

<ul>
<li>The sum of column <code>left</code> is 111, of column <code>middle</code> is 222, and of <code>right</code> is 333<ul>
<li>Once again <code>dtype</code> is the data type</li>
</ul>
</li>
<li>We can calculate several aggregate values at once by giving <code>DataFrame.agg</code> a list of function names<ul>
<li>Exercise: is this more efficient or not?</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(example.agg([&#39;sum&#39;, &#39;mean&#39;]))
</code></pre></div>

<div class="codehilite"><pre><span></span><code>       left  middle  right
sum   111.0   222.0  333.0
mean   37.0    74.0  111.0
</code></pre></div>

<h2>Selecting Subsets of Data</h2>
<ul>
<li>Suppose we want to look at the low values in the data</li>
<li>Do this by <span g="filter">filtering</span> data and calculating values for the rows we have kept<ul>
<li>"Keep" would have been a better name than "filter", but we're stuck with it</li>
</ul>
</li>
<li>Create another small dataframe to demonstrate</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">colors</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">],</span>
                      <span class="n">data</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span>  <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;aqua&#39;</span><span class="p">,</span>    <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                            <span class="p">[</span><span class="s1">&#39;fuchsia&#39;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>      name  red  green  blue
0   yellow  1.0    1.0   0.0
1     aqua  0.0    1.0   1.0
2  fuchsia  1.0    0.0   1.0
</code></pre></div>

<ul>
<li>We know how to select the <code>red</code> column</li>
</ul>
<div class="codehilite"><pre><span></span><code>red = colors[&#39;red&#39;]
print(red)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">    </span><span class="mf">1.0</span><span class="w"></span>
<span class="mf">1</span><span class="w">    </span><span class="mf">0.0</span><span class="w"></span>
<span class="mf">2</span><span class="w">    </span><span class="mf">1.0</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="n">float64</span><span class="w"></span>
</code></pre></div>

<ul>
<li>Now let's see where values are 1.0 and where they aren't</li>
</ul>
<div class="codehilite"><pre><span></span><code>has_red = (red == 1.0)
print(has_red)
</code></pre></div>

<div class="codehilite"><pre><span></span><code><span class="mf">0</span><span class="w">     </span><span class="n">True</span><span class="w"></span>
<span class="mf">1</span><span class="w">    </span><span class="n">False</span><span class="w"></span>
<span class="mf">2</span><span class="w">     </span><span class="n">True</span><span class="w"></span>
<span class="n">Name</span><span class="p">:</span><span class="w"> </span><span class="n">red</span><span class="p">,</span><span class="w"> </span><span class="n">dtype</span><span class="p">:</span><span class="w"> </span><span class="n">bool</span><span class="w"></span>
</code></pre></div>

<ul>
<li>The expression <code>(red == 1.0)</code> is no different from <code>(red + 3)</code>, except the result is <span g="boolean">Boolean</span> instead of numeric</li>
<li>If we use a Boolean vector as an index, the result is a smaller table containing only the rows where the index was <code>True</code><ul>
<li>But just as we had to use <code>.iloc[...]</code>, we have to use <code>.loc[...]</code> (for "location")</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">rows_with_red</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">colors</span><span class="p">.</span><span class="n">loc</span><span class="o">[</span><span class="n">has_red</span><span class="o">]</span><span class="w"></span>
<span class="k">print</span><span class="p">(</span><span class="n">rows_with_red</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>      name  red  green  blue
0   yellow  1.0    1.0   0.0
2  fuchsia  1.0    0.0   1.0
</code></pre></div>

<ul>
<li>So we can calculate the average red, green, and blue for all colors for the whole table:</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(colors.agg(&#39;mean&#39;))
</code></pre></div>

<div class="codehilite"><pre><span></span><code>red      0.666667
green    0.666667
blue     0.666667
dtype: float64
</code></pre></div>

<ul>
<li>Or select only those colors that contain some red and calculate the average for them:</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(rows_with_red.agg(&#39;mean&#39;))
</code></pre></div>

<div class="codehilite"><pre><span></span><code>red      1.0
green    0.5
blue     0.5
dtype: float64
</code></pre></div>

<ul>
<li>Creating temporary variables is unnecessary: we can index the table directly<ul>
<li>Though this can be hard to read because the order of operations doesn't match left-to-right reading order</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code>print(colors.loc[colors[&#39;red&#39;] == 1.0].agg(&#39;mean&#39;))
</code></pre></div>

<div class="codehilite"><pre><span></span><code>red      1.0
green    0.5
blue     0.5
dtype: float64
</code></pre></div>

<ul>
<li>This style of programming is called <span g="method_chaining">method chaining</span><ul>
<li>Each operation like <code>loc</code> and <code>agg</code> creates a new object</li>
<li>We immediately call a method of that new object</li>
<li>Then call a method of the object that method returns, and so on</li>
</ul>
</li>
<li>Behind the scenes, Pandas re-uses most of the data rather than copying it to make things faster</li>
</ul>
<h2>Lines and Characters in Python Files</h2>
<ul>
<li>Created a scatter plot earlier</li>
<li>Construct a <span g="histogram">histogram</span> to see how many <span g="outlier">outliers</span> there are<ul>
<li>Add width and height for the print version</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="n">packages</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;python-local-package-size.csv&#39;</span><span class="p">)</span>
<span class="n">packages</span> <span class="o">=</span> <span class="n">packages</span><span class="p">[</span><span class="n">packages</span><span class="p">[</span><span class="s1">&#39;Lines&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">packages</span><span class="p">[</span><span class="s1">&#39;ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">packages</span><span class="p">[</span><span class="s1">&#39;Characters&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">packages</span><span class="p">[</span><span class="s1">&#39;Lines&#39;</span><span class="p">]</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">packages</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">write_image</span><span class="p">(</span><span class="s1">&#39;hist-ratio-unscaled.svg&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</code></pre></div>

<figure id="hist-ratio-unscaled">
  <img src="./hist-ratio-unscaled.svg" alt="Ratio of Characters to Lines (Unscaled)" />
  <figcaption markdown="1">Figure 5.2: Linear-linear histogram with a single sharp spike at X equals 0 going up to Y equals 2,200 and nothing else visible up to X equals 9,000.</figcaption>
</figure>

<ul>
<li>That's not very informative<ul>
<li>A few large values near x=0</li>
<li>But a few very small values that go up over x=8000</li>
</ul>
</li>
<li>Plot the logarithm of the ratio to show things more clearly <span f="hist-ratio-scaled"/></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">fig</span> <span class="o">=</span> <span class="nv">px</span>.<span class="nv">histogram</span><span class="ss">(</span><span class="nv">packages</span>, <span class="nv">x</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ratio</span><span class="s1">&#39;</span>, <span class="nv">nbins</span><span class="o">=</span><span class="mi">100</span>, <span class="nv">log_y</span><span class="o">=</span><span class="nv">True</span><span class="ss">)</span>
<span class="nv">fig</span>.<span class="k">show</span><span class="ss">()</span>
<span class="nv">fig</span>.<span class="nv">write_image</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">hist-ratio-scaled.svg</span><span class="s1">&#39;</span><span class="ss">)</span>
</code></pre></div>

<figure id="hist-ratio-scaled">
  <img src="./hist-ratio-scaled.svg" alt="Ratio of Characters to Lines (Scaled)" />
  <figcaption markdown="1">Figure 5.3: Log-linear histogram with a single sharp spike at X equals 0 going up to Y equals 3,000 and a sharp decline to Y equals 2 near X equals 1,800 and one outlier of Y equals 2 at X equals 9,000.</figcaption>
</figure>

<ul>
<li>Play with a threshold for a bit and discover that less than 0.3% of records are above 100 characters per line</li>
<li>Plot all the values except these <em>without</em> logarithmic scaling<ul>
<li>Report how many were excluded so that readers know they're not seeing all the data</li>
</ul>
</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">print</span><span class="ss">(</span><span class="nv">f</span><span class="s2">&quot;</span><span class="s">Excluding {len(packages[packages[&#39;ratio&#39;] &gt; 100])}/{len(packages)} data points</span><span class="s2">&quot;</span><span class="ss">)</span>
<span class="nv">fig</span> <span class="o">=</span> <span class="nv">px</span>.<span class="nv">histogram</span><span class="ss">(</span><span class="nv">packages</span>[<span class="nv">packages</span>[<span class="s1">&#39;</span><span class="s">ratio</span><span class="s1">&#39;</span>] <span class="o">&lt;=</span> <span class="mi">100</span>], <span class="nv">x</span><span class="o">=</span><span class="s1">&#39;</span><span class="s">ratio</span><span class="s1">&#39;</span>, <span class="nv">nbins</span><span class="o">=</span><span class="mi">100</span><span class="ss">)</span>
<span class="nv">fig</span>.<span class="k">show</span><span class="ss">()</span>
<span class="nv">fig</span>.<span class="nv">write_image</span><span class="ss">(</span><span class="s1">&#39;</span><span class="s">hist-ratio-most.svg</span><span class="s1">&#39;</span><span class="ss">)</span>
</code></pre></div>

<div class="codehilite"><pre><span></span><code>Excluding 92 data points
</code></pre></div>

<figure id="hist-ratio-most">
  <img src="./hist-ratio-most.svg" alt="Ratio of Characters to Lines (Most)" />
  <figcaption markdown="1">Figure 5.4: Linear-linear histogram with apparently normal distribution peaking at Y equals 2200 near X equals 35.</figcaption>
</figure>

<ul>
<li>Data is easier to see</li>
<li>But what (if anything) does it <em>mean</em>?</li>
<li>For that, we need some statistics</li>
</ul>
<h2>Exercises</h2>
<h3>Dissecting the <code>find</code> Command</h3>
<p>Use [explainshell][explain-shell] to dissect the <code>find</code> command used to get Python file sizes.
Why is the semi-colon needed, and why does it have to have a backslash in front of it?</p>
<h3>One-Sided Average</h3>
<p>Is "average" a meaningful statistic for a <a class="glossref" href="../glossary/#one_sided_distribution" markdown="1">one-sided distribution</a>
with a <a class="glossref" href="../glossary/#long_tail" markdown="1">long tail</a>?
What would be a better way to characterize this distribution?</p>
<h3>Finding Python Files</h3>
<p>Write a short Python script to find Python source files and get their size.
(Hint: use the [<code>glob</code>][glob] module to find files.)</p>
<h3>Empty Python Files</h3>
<p>Why do empty Python files exist?
Why do some files have such very long lines?
Do any files have some characters but zero lines?
How should we represent these in our visualization?</p>
<h3>Meaningful Axis Labels</h3>
<p>Add meaningful axis labels to all of the plots.</p>
<h3>Characters Per Line</h3>
<p>What does the distribution of characters per line tell you about these files?
How does the ratio for your own files compare?</p>
<h3>Resetting a Dataframe's Index</h3>
<p>What does resetting the index of a dataframe do?
Why do we have to reset the index
in the script that counts the frequency of '.'-separated components of names?</p>

  <hr/>
<div class="centered">
  <table class="plain footer">
    <tr>
      
      <td><a href="../license/">License</a></td>
      
      <td><a href="../conduct/">Code of Conduct</a></td>
      
      <td><a href="../bibliography/">Bibliography</a></td>
      
      <td><a href="../glossary/">Glossary</a></td>
      
      <td><a href="../links/">Links</a></td>
      
      <td><a href="https://github.com/gvwilson/buildtogether.tech.git">GitHub</a></td>
      
    </tr>
  </table>
</div>

  </body>
</html>
